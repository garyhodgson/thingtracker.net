<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Thing Tracker Network - Thing Maker</title>

  <link rel="icon" href="/img/favicon.ico" type="image/x-icon" />

  <meta name="author" content="Derrick Oswald" />
  <!-- Date: 2013-03-27 -->

  <!--Modified for thingtracker.net by Gary Hodgson 2013-04-08 -->

  <script type="text/javascript" src="./bencoder.js"></script>
  <script type="text/javascript" src="./sha1.js"></script>
  <script type="text/javascript" src="./ThingMaker.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="/css/bootstrap/bootstrap.css" rel="stylesheet">
  <link href="/css/thingtracker.css" rel="stylesheet" media="screen" type="text/css">
  <link href="./css/thingmaker.css" rel="stylesheet" media="screen" type="text/css">
  <link href="/css/bootstrap/bootstrap-responsive.css" rel="stylesheet">
</head>
<body>

  <div id="navbar" class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">Thing Tracker Network</a>
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="/">Home</a></li>
              <li class="active"><a href="/tools/thingmaker/docs/modules/make_torrent.html">Generated Docs for ThingMaker</a></li>
            </ul>
            <ul class="nav pull-right">
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Jump To <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="/">Home</a></li>
                  <li class="nav-header">Info</li>
                  <li><a href="/specification.html">Technical Spec</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">Technical</li>
                  <li><a href="/tools/validator">Tracker Validator</a></li>
                  <li><a href="/tools/viewer">Tracker Viewer</a></li>
                  <li><a href="/tools/thingmaker">BitTorrent ThingMaker</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span2"></div>
            <div class="span8">
                <h1>Thing Maker</h1>
                <p>
                    <strong>Create a distributed <em>Thing</em> using the BitTorrent network.
                    </strong>
                </p>
                <div class="row-fluid">
                  <div class="span12">
                  The idea behind the Thing Maker is to use <a href="https://en.wikipedia.org/wiki/Bittorrent">BitTorrent</a>
                  to distribute <a href="http://thingtracker.net/">Thing Tracker things</a>.  An overview of the idea can be found <a href="http://my.brainshark.com/Distributed-Thing-Tracker-767853647">here</a>.
                  </div>
                  <br>
                  <br>
                    This page helps with the steps of the process shown below:
                </div>
                <!-- embed the image instead of referencing it img src="./assets/Thing%20Maker.svg" -->
<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   width="905.28571"
   height="141.57143"
   id="svg2"
   version="1.1"
   inkscape:version="0.48.4 r9939"
   sodipodi:docname="Thing Maker.svg">
  <defs
     id="defs4" />
  <sodipodi:namedview
     id="base"
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1.0"
     inkscape:pageopacity="0.0"
     inkscape:pageshadow="2"
     inkscape:zoom="1.4"
     inkscape:cx="438.81587"
     inkscape:cy="11.978716"
     inkscape:document-units="px"
     inkscape:current-layer="layer1"
     showgrid="false"
     inkscape:window-width="1920"
     inkscape:window-height="1019"
     inkscape:window-x="-9"
     inkscape:window-y="-9"
     inkscape:window-maximized="1"
     fit-margin-top="20"
     fit-margin-left="20"
     fit-margin-right="20"
     fit-margin-bottom="20" />
  <metadata
     id="metadata7">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
        <dc:title />
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <g
     inkscape:label="Layer 1"
     inkscape:groupmode="layer"
     id="layer1"
     transform="translate(65.433022,-144.99552)">
    <text
       xml:space="preserve"
       style="font-size:16px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;font-family:Frutiger Next LT W1G;-inkscape-font-specification:Frutiger Next LT W1G"
       x="209.55013"
       y="198.07648"
       id="text3755"
       sodipodi:linespacing="125%"><tspan
         sodipodi:role="line"
         x="209.55013"
         y="198.07648"
         style="text-align:center;text-anchor:middle"
         id="tspan3089">Step 2.</tspan><tspan
         sodipodi:role="line"
         x="209.55013"
         y="218.07648"
         id="tspan3763"
         style="text-align:center;text-anchor:middle">Provide any prior</tspan><tspan
         sodipodi:role="line"
         x="209.55013"
         y="238.07648"
         style="text-align:center;text-anchor:middle"
         id="tspan3103">version <tspan
   style="font-style:italic"
   id="tspan3113">Thing</tspan> file.</tspan></text>
    <text
       xml:space="preserve"
       style="font-size:16px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;font-family:Frutiger Next LT W1G;-inkscape-font-specification:Frutiger Next LT W1G"
       x="390.88214"
       y="198.07648"
       id="text3755-7"
       sodipodi:linespacing="125%"><tspan
         sodipodi:role="line"
         id="tspan3757-4"
         x="390.88214"
         y="198.07648"
         style="text-align:center;text-anchor:middle">Step 3.</tspan><tspan
         sodipodi:role="line"
         x="390.88214"
         y="218.07648"
         id="tspan3763-9"
         style="text-align:center;text-anchor:middle">Add or update</tspan><tspan
         sodipodi:role="line"
         x="390.88214"
         y="238.07648"
         style="text-align:center;text-anchor:middle"
         id="tspan3797"><tspan
   style="font-style:italic"
   id="tspan3107">Thing </tspan>metadata.</tspan></text>
    <text
       xml:space="preserve"
       style="font-size:16px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;font-family:Frutiger Next LT W1G;-inkscape-font-specification:Frutiger Next LT W1G"
       x="570.70862"
       y="197.85268"
       id="text3755-7-8"
       sodipodi:linespacing="125%"><tspan
         sodipodi:role="line"
         x="570.70862"
         y="197.85268"
         style="text-align:center;text-anchor:middle"
         id="tspan3797-4">Step 4.</tspan><tspan
         sodipodi:role="line"
         x="570.70862"
         y="217.85268"
         style="text-align:center;text-anchor:middle"
         id="tspan3835">Seed your</tspan><tspan
         sodipodi:role="line"
         x="570.70862"
         y="237.85268"
         style="text-align:center;text-anchor:middle"
         id="tspan3121"><tspan
   style="font-style:italic"
   id="tspan3837">Thing</tspan>.</tspan></text>
    <g
       id="g3848"
       transform="translate(26,0)">
      <path
         inkscape:connector-curvature="0"
         id="path3843"
         d="m 248.78371,221.00504 36.94581,0"
         style="fill:none;stroke:#008080;stroke-width:2.69698095;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" />
      <path
         inkscape:transform-center-y="-0.0027414005"
         inkscape:transform-center-x="-0.73726806"
         transform="matrix(0.16847952,0.98570515,-0.98570515,0.16847952,311.31424,-23.603224)"
         d="m 239.40616,67.511834 -2.52477,-0.436357 -2.52478,-0.436357 1.64028,-1.96834 1.64029,-1.96834 0.88449,2.404697 z"
         inkscape:randomized="0"
         inkscape:rounded="0"
         inkscape:flatsided="false"
         sodipodi:arg2="1.7419358"
         sodipodi:arg1="0.69473828"
         sodipodi:r2="1.4792894"
         sodipodi:r1="2.9585788"
         sodipodi:cy="65.617798"
         sodipodi:cx="237.13332"
         sodipodi:sides="3"
         id="path3845"
         style="fill:none;stroke:#008080;stroke-width:3;stroke-linecap:butt;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
         sodipodi:type="star" />
    </g>
    <g
       transform="translate(208.33126,0)"
       id="g3848-5">
      <path
         inkscape:connector-curvature="0"
         id="path3843-5"
         d="m 248.78371,221.00504 36.94581,0"
         style="fill:none;stroke:#008080;stroke-width:2.69698095;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" />
      <path
         inkscape:transform-center-y="-0.0027414005"
         inkscape:transform-center-x="-0.73726806"
         transform="matrix(0.16847952,0.98570515,-0.98570515,0.16847952,311.31424,-23.603224)"
         d="m 239.40616,67.511834 -2.52477,-0.436357 -2.52478,-0.436357 1.64028,-1.96834 1.64029,-1.96834 0.88449,2.404697 z"
         inkscape:randomized="0"
         inkscape:rounded="0"
         inkscape:flatsided="false"
         sodipodi:arg2="1.7419358"
         sodipodi:arg1="0.69473828"
         sodipodi:r2="1.4792894"
         sodipodi:r1="2.9585788"
         sodipodi:cy="65.617798"
         sodipodi:cx="237.13332"
         sodipodi:sides="3"
         id="path3845-1"
         style="fill:none;stroke:#008080;stroke-width:3;stroke-linecap:butt;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
         sodipodi:type="star" />
    </g>
    <text
       xml:space="preserve"
       style="font-size:16px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;font-family:Frutiger Next LT W1G;-inkscape-font-specification:Frutiger Next LT W1G"
       x="755.39899"
       y="197.43361"
       id="text3755-7-8-7"
       sodipodi:linespacing="125%"><tspan
         sodipodi:role="line"
         x="755.39899"
         y="197.43361"
         style="text-align:center;text-anchor:middle"
         id="tspan3797-4-4">Step 5.</tspan><tspan
         sodipodi:role="line"
         x="755.39899"
         y="217.43361"
         style="text-align:center;text-anchor:middle"
         id="tspan3835-0">Publish your<tspan
   style="font-style:oblique;-inkscape-font-specification:Frutiger Next LT W1G Oblique"
   id="tspan3051" /></tspan><tspan
         sodipodi:role="line"
         x="755.39899"
         y="237.43361"
         style="text-align:center;text-anchor:middle"
         id="tspan3117"><tspan
   style="font-style:oblique;-inkscape-font-specification:Frutiger Next LT W1G Oblique"
   id="tspan3119">Thing</tspan>.</tspan></text>
    <g
       transform="translate(389.02167,-0.41907143)"
       id="g3848-5-4">
      <path
         inkscape:connector-curvature="0"
         id="path3843-5-8"
         d="m 248.78371,221.00504 36.94581,0"
         style="fill:none;stroke:#008080;stroke-width:2.69698095;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" />
      <path
         inkscape:transform-center-y="-0.0027414005"
         inkscape:transform-center-x="-0.73726806"
         transform="matrix(0.16847952,0.98570515,-0.98570515,0.16847952,311.31424,-23.603224)"
         d="m 239.40616,67.511834 -2.52477,-0.436357 -2.52478,-0.436357 1.64028,-1.96834 1.64029,-1.96834 0.88449,2.404697 z"
         inkscape:randomized="0"
         inkscape:rounded="0"
         inkscape:flatsided="false"
         sodipodi:arg2="1.7419358"
         sodipodi:arg1="0.69473828"
         sodipodi:r2="1.4792894"
         sodipodi:r1="2.9585788"
         sodipodi:cy="65.617798"
         sodipodi:cx="237.13332"
         sodipodi:sides="3"
         id="path3845-1-8"
         style="fill:none;stroke:#008080;stroke-width:3;stroke-linecap:butt;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
         sodipodi:type="star" />
    </g>
    <rect
       style="fill:none;stroke:#008080;stroke-width:2.2925272;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
       id="rect2985-17"
       width="137.13605"
       height="99.2789"
       x="-44.286758"
       y="166.14178"
       ry="1.9259558" />
    <text
       xml:space="preserve"
       style="font-size:16px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;font-family:Frutiger Next LT W1G;-inkscape-font-specification:Frutiger Next LT W1G"
       x="28.331375"
       y="198.13838"
       id="text3755-4"
       sodipodi:linespacing="125%"><tspan
         sodipodi:role="line"
         id="tspan3757-0"
         x="28.331375"
         y="198.13838"
         style="text-align:center;text-anchor:middle">Step 1.</tspan><tspan
         sodipodi:role="line"
         x="28.331375"
         y="218.13838"
         style="text-align:center;text-anchor:middle"
         id="tspan3079">Select the files</tspan><tspan
         sodipodi:role="line"
         x="28.331375"
         y="238.13838"
         style="text-align:center;text-anchor:middle"
         id="tspan3081">for your <tspan
   style="font-style:italic"
   id="tspan3115">Thing</tspan>.</tspan></text>
    <g
       transform="translate(-155.88749,-0.91157286)"
       id="g3848-8">
      <path
         inkscape:connector-curvature="0"
         id="path3843-8"
         d="m 248.78371,221.00504 36.94581,0"
         style="fill:none;stroke:#008080;stroke-width:2.69698095;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" />
      <path
         inkscape:transform-center-y="-0.0027414005"
         inkscape:transform-center-x="-0.73726806"
         transform="matrix(0.16847952,0.98570515,-0.98570515,0.16847952,311.31424,-23.603224)"
         d="m 239.40616,67.511834 -2.52477,-0.436357 -2.52478,-0.436357 1.64028,-1.96834 1.64029,-1.96834 0.88449,2.404697 z"
         inkscape:randomized="0"
         inkscape:rounded="0"
         inkscape:flatsided="false"
         sodipodi:arg2="1.7419358"
         sodipodi:arg1="0.69473828"
         sodipodi:r2="1.4792894"
         sodipodi:r1="2.9585788"
         sodipodi:cy="65.617798"
         sodipodi:cx="237.13332"
         sodipodi:sides="3"
         id="path3845-2"
         style="fill:none;stroke:#008080;stroke-width:3;stroke-linecap:butt;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
         sodipodi:type="star" />
    </g>
    <rect
       style="fill:none;stroke:#008080;stroke-width:2.2925272;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
       id="rect2985-17-4"
       width="137.13605"
       height="99.2789"
       x="137.17752"
       y="166.14178"
       ry="1.9259558" />
    <rect
       style="fill:none;stroke:#008080;stroke-width:2.2925272;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
       id="rect2985-17-5"
       width="137.13605"
       height="99.2789"
       x="318.64178"
       y="166.14178"
       ry="1.9259558" />
    <rect
       style="fill:none;stroke:#008080;stroke-width:2.2925272;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
       id="rect2985-17-51"
       width="137.13605"
       height="99.2789"
       x="500.10611"
       y="166.14178"
       ry="1.9259558" />
    <rect
       style="fill:none;stroke:#008080;stroke-width:2.2925272;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
       id="rect2985-17-7"
       width="137.13605"
       height="99.2789"
       x="681.57037"
       y="166.14178"
       ry="1.9259558" />
  </g>
</svg>
                <div class="step">
                    <h2>STEP 1</h2>
                    Identify the files to be included in your <em>Thing</em>. <br>
                    Currently, you can either select a single file by clicking on the button below and using the "File Upload"
                    dialog to navigate to and identify the file,
                    or you can drag and drop a list of files onto the button (this only works in FireFox but will be fixed eventually).
                    <div id="choose_thing_form">
                        Select file(s): <input id="thing_files" type="file" name="file" />
                    </div>
                    <div id="file_content"></div>
                </div>
                <div class="step">
                    <h2>STEP 2</h2>
                    <em>This step is optional.</em><br>
                    Choose a torrent file that will be used as a basis for the <em>Thing</em> you create.<br>
                    This can be a torrent file from a previous version of your <em>Thing</em>, or just a template torrent file
                    that has mostly the same metadata as you will be filling in in Step 3. In the latter case, change
                    the name to avoid creating a new version of the template <em>Thing</em> by accident.
                    <div id="choose_torrent_basis_form">
                        Choose a base torrent file: <input id="torrent_files" type="file" name="file" />
                    </div>
                    <div id="byte_content"></div>
                </div>
                <div class="step">
                    <h2>STEP 3</h2>
                    Fill in this form with the metadata for your <em>Thing</em> and press the <b>Make Thing</b> button.<br>
                    For details about the fields, consult the <a href="http://thingtracker.net/#specification">specification</a>.
                    Tags are comma separated.
                    <form id="thing_form" action="javascript:submit_form ();">
                        <ul>
                            <li><label class="thing_form_label" form="thing_form" for="title">Title</label><input id="title"
                                form="thing_form" type="text" name="title"></li>
                            <li><label class="thing_form_label" form="thing_form" for="URL">URL</label><input id="URL"
                                form="thing_form" type="text" name="URL"></li>
                            <li><label class="thing_form_label" form="thing_form" for="author">Author</label><input id="author"
                                form="thing_form" type="text" name="author"></li>
                            <li><label class="thing_form_label" form="thing_form" for="license">License</label><input
                                id="license" form="thing_form" type="text" name="license"></li>
                            <li><label class="thing_form_label" form="thing_form" for="tags">Tags</label><input id="tags"
                                form="thing_form" type="text" name="tags"></li>
                            <li><label class="thing_form_label" form="thing_form" for="thumbnailURL">Thumbnail URL</label><input
                                id="thumbnailURL" form="thing_form" type="text" name="thumbnailURL"></li>
                            <li><label class="thing_form_label" form="thing_form" for="description">Description</label><input
                                id="description" form="thing_form" type="text" name="description"></li>
                            <li><input class="thing_form_button" form="thing_form" type="submit" value="Make Thing"
                                name="make_thing" disabled="disabled"></li>
                        </ul>
                    </form>
                </div>
                <div class="step">
                    <h2>STEP 4</h2>
                    Download the torrent file by clicking on the link below, save it, and together
                    with the files that you specified in the base torrent file in Step 0,
                    seed your thing in your BitTorrent client.
                    <div id="bencode_content"></div>
                    <div id="torrent_content"></div>
                </div>
                <div class="step">
                    <h2>STEP 5</h2>
                    Publish your <em>Thing</em> by proudly displaying this magnet link.
                    <div id="magnet_content"></div>
                </div>
            </div>
            <div class="span2"></div>
        </div>
    </div>

    <script src="http://code.jquery.com/jquery-1.8.1.min.js"> </script>
    <script src="/js/bootstrap/bootstrap.min.js"></script>

    <script>
                    // torrent to use as a base
                    var TorrentFile = null;
                    var Torrent = null;

                    function format (text)
                    {
                        var pre = document.createElement ("pre");
                        var code = document.createElement ("code");
                        pre.appendChild (code);
                        var pieces = text.split ('\n');
                        for ( var i = 0; i < pieces.length; i++)
                        {
                            code.appendChild (document.createTextNode (pieces[i]));
                            code.appendChild (document.createElement ("br"));
                        }

                        return (pre);
                    }

                    function clean_add (element, node)
                    {
                        var content = document.getElementById (element);
                        var child = content.firstChild;
                        while (null != child)
                        {
                            content.removeChild (child);
                            child = content.firstChild;
                        }
                        content.appendChild (node);
                    }

                    // show the contents of the Thing object in the content area
                    function showcontent (torrent, element)
                    {
                        // show the torrent contents
                        var raw_text = torrent.toString ();
                        //var raw_text = printpieces (torrent["info"]["pieces"]);
                        clean_add (element, format (raw_text));
                    }

                    // copy the Thing properties, if found, to the input fields of the form
                    function fillform (torrent)
                    {
                        var thing = torrent["info"]["thing"];
                        if (null != thing)
                        {
                            var form = document.getElementById ('thing_form');
                            if (null != form)
                            {
                                for (i = 0; i < form.elements.length; i++)
                                {
                                    var child = form.elements[i];
                                    var id = child.getAttribute ("id");
                                    if (null != id)
                                    {
                                        var value = thing[id];
                                        // based on the type, assign the value
                                        if (null != value)
                                            child.value = value;
                                    }
                                }
                            }
                        }
                    }

                    // enable the Make Thing button
                    function enablebutton ()
                    {
                        var children = document.getElementsByName ("make_thing");
                        for (i = 0; i < children.length; i++)
                        {
                            var child = children[i];
                            child.removeAttribute ("disabled");
                        }
                    }

                    // callback for reading the torrent file
                    function cb (filename, torrent)
                    {
                        TorrentFileName = filename;
                        Torrent = torrent;
                        enablebutton ();
                        showcontent (torrent, "byte_content");
                        fillform (torrent);
                    }

                    // make a title for the thing
                    function maketitle ()
                    {
                        var title = Torrent["info"]["thing"]["title"];
                        if (null == title)
                        {
                            var thing_file = TorrentFileName || "Thing"; // default name is the file name
                            var n = thing_file.lastIndexOf (".");
                            if (-1 == n)
                                title = thing_file;
                            else
                                title = thing_file.substring (0, n);
                        }
                        title = title.replace (/\&/g, "and");
                        title = title.replace (/ /g, "%20");

                        return (title);
                    }

                    // show the contents of the encoded Thing as a link in the content area
                    function showlink (torrent)
                    {
                        // show the torrent contents
                        var a = document.createElement ("a");
                        a.setAttribute ("href", "data:application/octet-stream;base64," + btoa (torrent));
                        a.setAttribute ("download", maketitle () + ".torrent");
                        var text = document.createTextNode ("Torrent File");
                        a.appendChild (text);
                        var content = document.getElementById ('bencode_content');
                        var child = content.firstChild;
                        while (null != child)
                        {
                            content.removeChild (child);
                            child = content.firstChild;
                        }
                        content.appendChild (a);
                    }

                    // show the magnet url as a link in the content area
                    function showmagnet ()
                    {
                        // generate the 160 bit (40 hex characters) info primary key magnet URL
                        var title = maketitle ();
                        var info = Torrent["info"];
                        var primary_key = sha1 (encode (info));
                        var magnet = "magnet:?xt=urn:btih:" + primary_key + "&dn=" + title;

                        // show the magnet link URI
                        var a = document.createElement ("a");
                        a.setAttribute ("href", magnet);
                        a.setAttribute ("title", "Download this torrent using magnet");
                        var img = document.createElement ("img");
                        a.appendChild (img);
                        img.setAttribute ("id", "magnet_icon");
                        img.setAttribute ("src", "https://upload.wikimedia.org/wikipedia/commons/7/7c/Magnet_icon.svg");
                        img.setAttribute ("height", "48");
                        img.setAttribute ("width", "48");
                        var text = document.createTextNode ("Magnet Link");
                        a.appendChild (text);
                        var content = document.getElementById ('magnet_content');
                        var child = content.firstChild;
                        while (null != child)
                        {
                            content.removeChild (child);
                            child = content.firstChild;
                        }
                        content.appendChild (a);

                        // show the HTML code
                        var div = document.createElement ("div");
                        text = document.createTextNode (content.innerHTML);
                        div.appendChild (text);
                        content.appendChild (div);
                    }

                    // callback for writing (and then reading back) the torrent file
                    function callback (filename, torrent)
                    {
                        showcontent (torrent, "torrent_content");
                        showmagnet (torrent);
                    }

                    // called on form submit
                    function submit_form ()
                    {
                        if (null == Torrent)
                            Torrent = MakeTorrent ();

                        Torrent["info"]["thing"] = {};
                        var thing = Torrent["info"]["thing"];
                        var form = document.getElementById ('thing_form');
                        if (null != form)
                        {
                            for (i = 0; i < form.elements.length; i++)
                            {
                                var child = form.elements[i];
                                var id = child.getAttribute ("id");
                                if (null != id)
                                {
                                    var value = child.value;
                                    if ((null != value) && ("" != value))
                                    {
                                        thing[id] = value;
                                        // kludge here to handle the list of tags
                                        if ("tags" == id)
                                            thing[id] = value.split (',');
                                    }
                                }
                            }
                        }

                        var output = encode (Torrent);
                        showlink (output);
                        ReadStringAsync (output, callback);
                    }

                    function cb3 (sha)
                    {
                        clean_add ("file_content", format (sha));
                    }

                    function tohex (val)
                    {
                        var str = "";
                        var i;
                        var v;

                        for (i = 7; i >= 0; i--)
                        {
                            v = (val >>> (i * 4)) & 0x0f;
                            str += v.toString (16);
                        }
                        return str;
                    };

                    document.querySelector ('#thing_files').addEventListener ('change', function (evt)
                    {
                        if (evt.target.tagName.toLowerCase () == 'input')
                        {
                            var files;

                            files = document.getElementById ('thing_files').files;
                            //alert ("" + files.length + " files [0] " + files[0].name);
                            if (0 != files.length)
                            {
                                ReadFilesAsync (files, 16384, cb3);
                                enablebutton ();
                            }
                            else
                                alert ('Please select a file.');
                        }
                    }, false);
                    document.querySelector ('#torrent_files').addEventListener ('change', function (evt)
                    {
                        if (evt.target.tagName.toLowerCase () == 'input')
                        {
                            var files;

                            files = document.getElementById ('torrent_files').files;
                            if (0 != files.length)
                                ReadTorrentAsync (files[0], cb);
                            else
                                alert ('Please select a file.');
                        }
                    }, false);
                </script>

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-107923-8']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
</body>
</html>

